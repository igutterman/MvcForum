<!DOCTYPE html>

@using MvcForum.ViewModels;
@using SixLabors.ImageSharp;
@using MvcForum.Models;
@using System.Web;



@model ThreadViewModel;


@{
    ViewData["Title"] = "/int/";
    Layout = null;
}


<head>
    <title>/int/</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="Stylesheet" href="@Href("~/css/BoardIndex.css")" />
</head>

<body>


        <div class="BoardName">
        <h1>/int/</h1>
        </div>



    <partial name="~/Views/Shared/_PostingForm.cshtml" />


    <div class="Thread">

        @{
            Post OPpost = Model.Thread.Posts[0];
            string imagePath = Model.WebRootPath + "/images/" + OPpost.Files[0].FullFileName;
            string imageFileName = System.IO.Path.GetFileName(imagePath);
            using (var image = SixLabors.ImageSharp.Image.Load(imagePath))
            {
                double FileSize = new System.IO.FileInfo(imagePath).Length;
                FileSize *= 0.00097656;
                FileSize = Math.Round(FileSize, 2);

                <div class = 'OpPost'>
                    <div class = 'OpPicInfo'>
                        <span>File: </span><span class = 'OpPicLink'><a href = @imageFileName>@imageFileName</a></span>
                        <span>@FileSize.ToString()KB, @image.Width x @image.Height</span>
                    </div>

                    <div class = 'OpPic'>
                        <img id = '@OPpost.Files[0].FullFileName' src='/images/@OPpost.Files[0].ThumbFileName' onclick='resizeImage(event)'>

                    </div>
                    <div class = 'PostInfo'>
                        @*No Name field in Post model*@
                        <span class = 'PostSubject'>@OPpost.Subject</span>
                        <span class = 'PosterName'>Anonymous</span>
                        <span class = 'Timestamp'>@OPpost.Timestamp.ToString()</span>
                    </div>
                    <div class = 'PostText'>
                        @Html.Raw(HttpUtility.HtmlEncode(OPpost.Text.Replace("<br/>", "\n").Replace("<br />", "\n")).Replace("\n", "<br/>"))
                    </div>
                </div>


                @foreach (var post in Model.Thread.Posts)
                if (!post.IsOP)
                {
                        
                    {
                        if (post.HasImage)
                        {
                            imagePath = Model.WebRootPath + "/images/" + post.Files[0].FullFileName;
                            imageFileName = System.IO.Path.GetFileName(imagePath);
                            using (var image1 = SixLabors.ImageSharp.Image.Load(imagePath))
                            {
                                FileSize = new System.IO.FileInfo(imagePath).Length;
                                FileSize *= 0.00097656;
                                FileSize = Math.Round(FileSize, 2);
                        

                            <div class = 'ImageReplyPost'>
                                <div class = 'PostInfo'>
                                    <span class = 'PostSubject'>@OPpost.Subject</span>
                                    <span class = 'PosterName'>Anonymous</span>
                                    <span class = 'Timestamp'>@post.Timestamp.ToString()</span>
                                </div>
                                <div class = 'ReplyImageInfo'>
                                    <span>File: </span><span class = 'ReplyPicLink'><a href = @imageFileName>@imageFileName</a></span>
                                    <span>@FileSize.ToString()KB, @image.Width x @image.Height</span>
                                </div>
                                <div class = 'ReplyImageTextContainer'>
                                    <div class = 'ReplyImage'>
                                        <img id = '@post.Files[0].FullFileName' src = '/images/@post.Files[0].ThumbFileName' onclick = 'resizeImage(event)'>

                                    </div>
                                    <div class = 'PostText'>
                                        @Html.Raw(HttpUtility.HtmlEncode(post.Text.Replace("<br/>", "\n").Replace("<br />", "\n")).Replace("\n", "<br/>"))
                                    </div>

                                </div>
                            </div>
                            }
                        } else
                        {
                            <div class = 'ReplyPost'>
                                <div class = 'PostInfo'>
                                    <span class = 'PostSubject'>@OPpost.Subject</span>
                                    <span class = 'PosterName'>Anonymous</span>
                                    <span class = 'Timestamp'>@post.Timestamp.ToString()</span>
                                </div>
                                <div class = 'PostText'>
                                    @Html.Raw(HttpUtility.HtmlEncode(post.Text.Replace("<br/>", "\n").Replace("<br />", "\n")).Replace("\n", "<br/>"))
                                </div>

                            </div>
                        }
                    }
                }


            }
        }



         </div>


</body>



<script src="~/js/site.js" asp-append-version="true"></script>

